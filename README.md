# Сколько я должен Васе (Food Debt Tracker)

Telegram-бот для учёта совместных расходов на еду и расчёта долгов между участниками.

## Проблема

Каждую пятницу коллеги заказывают пиццу на 4200 рублей. Через две недели никто не помнит, кто платил и кто уже скинулся:

> "Это было две недели назад, а на прошлой ты не скидывал"

Дружба страдает из-за путаницы с деньгами.

## Решение

Бот автоматически:
- Фиксирует заказы с суммой и участниками
- Рассчитывает равное деление
- Ведёт учёт долгов (кто кому сколько должен)
- Записывает платежи
- Показывает текущее состояние расчётов

## Технологии

- **Python 3.10+**
- **aiogram** - асинхронный Telegram Bot API
- **SQLite** - хранение данных
- **pytest-bdd** - поведенческое тестирование

## Установка

```bash
# Клонирование
git clone <repo-url>
cd pizzatg

# Виртуальное окружение
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или venv\Scripts\activate  # Windows

# Зависимости
pip install -r requirements.txt
```

## Запуск тестов

```bash
pytest
```

## Запуск бота

```bash
# Создайте файл .env на основе примера
cp .env.example .env

# Отредактируйте .env и укажите токен бота
# BOT_TOKEN=your_telegram_bot_token

# Установите зависимости (если не установлены)
pip install -r requirements.txt

# Запустите бота
python -m src.bot.app
```

Токен можно получить у [@BotFather](https://t.me/BotFather) в Telegram.

## Использование

### Создание заказа
```
пицца 4200 @ivan @petya @masha
```
Создаёт заказ на 4200₽, делит между тремя участниками (по 1400₽).

### Запись платежа
```
/paid @ivan 1400
```
Фиксирует оплату 1400₽ пользователю @ivan.

### Просмотр долгов
```
/debts - мои долги
/owed - кто мне должен
/all - все долги в группе
```

### Удаление заказов
```
/delete - удалить последний заказ, который я создал
```
Удаляет ваш последний введённый заказ (даже если платил кто-то другой).

### Другие команды
```
/start - приветствие и инструкция
/help - справка по командам
```

## Архитектура

```
src/
├── domain/      # Бизнес-логика (без зависимостей)
├── persistence/ # Работа с БД
└── bot/         # Telegram-обработчики
```

Доменная логика полностью независима от Telegram и может тестироваться изолированно.

## Разработка

Проект следует методологии BDD + TDD:

1. Сценарии (.feature) описывают поведение
2. Step definitions вызывают реальный код
3. Тесты падают до реализации
4. Минимальная реализация для прохождения тестов
5. Рефакторинг

## Статус

✅ **Готово** — 64 теста (BDD: команды, платежи, изоляция чатов, сжатая интеграция)

- [x] Создание заказов
- [x] Расчёт долгов
- [x] Запись платежей
- [x] Просмотр долгов
- [x] Удаление заказов
- [x] SQLite хранение с миграциями и chat_id
- [x] Telegram бот с изоляцией чатов (multi-group)


## Лицензия

MIT
