# language: ru
Feature: Просмотр долгов
  Как пользователь системы
  Я хочу видеть текущее состояние долгов
  Чтобы понимать кто кому и сколько должен

  # MVP: базовые запросы долгов

  Scenario: Просмотр своих долгов (я должен)
    Given создан заказ "пицца" на 3000 рублей с плательщиком "ivan" и участниками "ivan", "petya", "masha"
    And создан заказ "суши" на 2000 рублей с плательщиком "anna" и участниками "anna", "petya"
    When "petya" запрашивает свои долги
    Then результат содержит долг 1000 рублей перед "ivan"
    And результат содержит долг 1000 рублей перед "anna"
    And общая сумма долгов равна 2000 рублей

  Scenario: Просмотр кто должен мне
    Given создан заказ "пицца" на 3000 рублей с плательщиком "ivan" и участниками "ivan", "petya", "masha"
    When "ivan" запрашивает кто ему должен
    Then результат содержит долг "petya" на 1000 рублей
    And результат содержит долг "masha" на 1000 рублей
    And общая сумма к получению равна 2000 рублей

  Scenario: Нет долгов
    Given пользователь "newuser" существует
    And у "newuser" нет заказов
    When "newuser" запрашивает свои долги
    Then результат пуст
    And сообщение "Долгов нет"

  Scenario: Никто не должен
    Given пользователь "newuser" существует
    And у "newuser" нет заказов
    When "newuser" запрашивает кто ему должен
    Then результат пуст
    And сообщение "Вам никто не должен"

  Scenario: Долги после частичной оплаты
    Given создан заказ "пицца" на 2000 рублей с плательщиком "ivan" и участниками "ivan", "petya"
    And "petya" заплатил "ivan" 500 рублей
    When "petya" запрашивает свои долги
    Then результат содержит долг 500 рублей перед "ivan"

  Scenario: Долги полностью погашены
    Given создан заказ "пицца" на 2000 рублей с плательщиком "ivan" и участниками "ivan", "petya"
    And "petya" заплатил "ivan" 1000 рублей
    When "petya" запрашивает свои долги
    Then результат пуст
    And сообщение "Долгов нет"

  Scenario: Просмотр всех долгов в группе
    Given создан заказ "пицца" на 3000 рублей с плательщиком "ivan" и участниками "ivan", "petya", "masha"
    When запрашиваются все долги в группе
    Then результат содержит:
      | должник | кредитор | сумма |
      | petya   | ivan     | 1000  |
      | masha   | ivan     | 1000  |
