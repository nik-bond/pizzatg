# language: ru
Feature: Создание заказа
  Как участник совместного заказа
  Я хочу зафиксировать расход с указанием суммы и участников
  Чтобы система могла рассчитать кто кому должен

  # MVP: базовое создание заказа с равным делением

  Scenario: Создание заказа с тремя участниками
    Given пользователь "ivan" является плательщиком
    When создается заказ "пицца" на сумму 3000 рублей
    And участники заказа: "ivan", "petya", "masha"
    Then заказ успешно создан
    And сумма на каждого участника равна 1000 рублей

  Scenario: Создание заказа с двумя участниками
    Given пользователь "anna" является плательщиком
    When создается заказ "суши" на сумму 2000 рублей
    And участники заказа: "anna", "boris"
    Then заказ успешно создан
    And сумма на каждого участника равна 1000 рублей

  Scenario: Создание заказа с неделимой суммой
    Given пользователь "ivan" является плательщиком
    When создается заказ "кофе" на сумму 100 рублей
    And участники заказа: "ivan", "petya", "masha"
    Then заказ успешно создан
    And сумма на каждого участника равна 33.33 рублей

  Scenario Outline: Ошибка при некорректной сумме
    Given пользователь "ivan" является плательщиком
    When создается заказ "еда" на сумму <сумма> рублей
    And участники заказа: "ivan", "petya"
    Then возникает ошибка "<сообщение>"
    And заказ не создан

    Examples:
      | сумма  | сообщение                          |
      | 0      | Сумма должна быть положительной    |
      | -100   | Сумма должна быть положительной    |

  Scenario: Ошибка при слишком большой сумме
    Given пользователь "ivan" является плательщиком
    When создается заказ "яхта" на сумму 1000000001 рублей
    And участники заказа: "ivan", "petya"
    Then возникает ошибка "Сумма превышает допустимый лимит"
    And заказ не создан

  Scenario: Ошибка при отсутствии участников
    Given пользователь "ivan" является плательщиком
    When создается заказ "пицца" на сумму 1000 рублей
    And участники заказа отсутствуют
    Then возникает ошибка "Требуется минимум два участника"
    And заказ не создан

  Scenario: Ошибка при одном участнике
    Given пользователь "ivan" является плательщиком
    When создается заказ "пицца" на сумму 1000 рублей
    And участники заказа: "ivan"
    Then возникает ошибка "Требуется минимум два участника"
    And заказ не создан

  Scenario: Плательщик автоматически включается в участники
    Given пользователь "ivan" является плательщиком
    When создается заказ "пицца" на сумму 2000 рублей
    And участники заказа: "petya", "masha"
    Then заказ успешно создан
    And "ivan" включен в список участников
    And сумма на каждого участника равна 666.67 рублей
