# language: ru
Feature: Расчёт долгов
  Как система учёта расходов
  Я должна корректно рассчитывать кто кому и сколько должен
  Чтобы участники знали свои обязательства

  # MVP: долги создаются от участников к плательщику

  Scenario: Долги создаются после заказа
    Given пользователь "ivan" является плательщиком
    And создан заказ "пицца" на 3000 рублей с участниками "ivan", "petya", "masha"
    Then "petya" должен "ivan" 1000 рублей
    And "masha" должен "ivan" 1000 рублей
    And "ivan" никому не должен

  Scenario: Плательщик не должен сам себе
    Given пользователь "ivan" является плательщиком
    And создан заказ "пицца" на 2000 рублей с участниками "ivan", "petya"
    Then "ivan" не имеет долга перед "ivan"
    And "petya" должен "ivan" 1000 рублей

  Scenario: Накопление долгов от нескольких заказов
    Given пользователь "ivan" является плательщиком
    And создан заказ "пицца" на 2000 рублей с участниками "ivan", "petya"
    And создан заказ "напитки" на 1000 рублей с участниками "ivan", "petya"
    Then "petya" должен "ivan" 1500 рублей

  Scenario: Взаимные долги учитываются отдельно
    Given создан заказ "пицца" на 2000 рублей с плательщиком "ivan" и участниками "ivan", "petya"
    And создан заказ "суши" на 2000 рублей с плательщиком "petya" и участниками "ivan", "petya"
    Then "petya" должен "ivan" 1000 рублей
    And "ivan" должен "petya" 1000 рублей

  Scenario: Расчёт чистого баланса между двумя пользователями
    Given создан заказ "пицца" на 2000 рублей с плательщиком "ivan" и участниками "ivan", "petya"
    And создан заказ "суши" на 2000 рублей с плательщиком "petya" и участниками "ivan", "petya"
    When запрашивается чистый баланс между "ivan" и "petya"
    Then чистый баланс равен 0 рублей

  Scenario: Чистый баланс при неравных долгах
    Given создан заказ "пицца" на 3000 рублей с плательщиком "ivan" и участниками "ivan", "petya"
    And создан заказ "суши" на 1000 рублей с плательщиком "petya" и участниками "ivan", "petya"
    When запрашивается чистый баланс между "ivan" и "petya"
    Then "petya" должен "ivan" чистыми 1000 рублей
