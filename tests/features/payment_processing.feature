# language: ru
Feature: Обработка платежей
  Как должник
  Я хочу фиксировать оплату долга
  Чтобы уменьшить свою задолженность

  # MVP: простые платежи уменьшают долг

  Background:
    Given создан заказ "пицца" на 3000 рублей с плательщиком "ivan" и участниками "ivan", "petya", "masha"
    # petya должен ivan 1000, masha должен ivan 1000

  Scenario: Полная оплата долга
    Given "petya" должен "ivan" 1000 рублей
    When "petya" платит "ivan" 1000 рублей
    Then платёж успешно записан
    And "petya" должен "ivan" 0 рублей

  Scenario: Частичная оплата долга
    Given "petya" должен "ivan" 1000 рублей
    When "petya" платит "ivan" 400 рублей
    Then платёж успешно записан
    And "petya" должен "ivan" 600 рублей

  Scenario: Несколько частичных платежей
    Given "petya" должен "ivan" 1000 рублей
    When "petya" платит "ivan" 300 рублей
    And "petya" платит "ivan" 300 рублей
    Then "petya" должен "ivan" 400 рублей

  Scenario: Ошибка при оплате больше долга
    Given "petya" должен "ivan" 1000 рублей
    When "petya" пытается заплатить "ivan" 1500 рублей
    Then возникает ошибка "Сумма платежа превышает долг"
    And долг "petya" перед "ivan" остаётся 1000 рублей

  Scenario: Ошибка при отрицательном платеже
    Given "petya" должен "ivan" 1000 рублей
    When "petya" пытается заплатить "ivan" -100 рублей
    Then возникает ошибка "Сумма платежа должна быть положительной"
    And долг "petya" перед "ivan" остаётся 1000 рублей

  Scenario: Ошибка при нулевом платеже
    Given "petya" должен "ivan" 1000 рублей
    When "petya" пытается заплатить "ivan" 0 рублей
    Then возникает ошибка "Сумма платежа должна быть положительной"
    And долг "petya" перед "ivan" остаётся 1000 рублей

  Scenario: Ошибка при оплате несуществующего долга
    Given "masha" не должен "petya" ничего
    When "masha" пытается заплатить "petya" 500 рублей
    Then возникает ошибка "Долг не найден"

  Scenario: Платёж не влияет на долги других участников
    Given "petya" должен "ivan" 1000 рублей
    And "masha" должен "ivan" 1000 рублей
    When "petya" платит "ivan" 1000 рублей
    Then "petya" должен "ivan" 0 рублей
    And "masha" должен "ivan" 1000 рублей
